import dns.resolver
import sys
import time
import json

dominio = sys.argv[1]

resolvidos = []
registros = {}

with open(sys.argv[2]) as wordlist:

    for i in wordlist.readlines():
        i = i.replace('\n',"")
        
        subdominio = f"{i}.{dominio}"

        if subdominio not in resolvidos:
            while True: 
                resolvidos.append(subdominio) 

                try:
                    resposta = dns.resolver.resolve(subdominio,"CNAME")
                    cname = str(resposta[0])

                    registros[subdominio] = cname
                    print(f"{subdominio} - Ã© um alias para - {cname} ")
                    break
                except dns.resolver.NoAnswer:
                    break
                except dns.resolver.NXDOMAIN:
                    break
                except dns.resolver.LifetimeTimeout:
                    time.sleep(3)
                except dns.resolver.NoNameservers:
                    None

registros_json = json.dumps(registros)
with open(f"{dominio}-cnames.json", "w") as f:
    f.write(registros_json)

