# ğŸŒ WHOIS

## ğŸ“Œ O que Ã© WHOIS

- **Protocolo** e **banco de dados pÃºblico**
- Permite consultar informaÃ§Ãµes sobre:
  - Dono de um domÃ­nio
  - Registrador
  - Datas de criaÃ§Ã£o e expiraÃ§Ã£o
  - Servidores DNS

---

# ğŸ” Como Funciona uma Consulta WHOIS

A busca WHOIS ocorre em **duas requisiÃ§Ãµes**.

---

## 1ï¸âƒ£ Primeira RequisiÃ§Ã£o (Servidor Referenciador)

- Enviamos uma **WHOIS query** para um servidor principal
- Exemplo:
  - `whois.verisign-grs.com`

ğŸ“Œ Esse servidor:

- **NÃ£o possui** todas as informaÃ§Ãµes do domÃ­nio
- Retorna o **endereÃ§o de outro servidor WHOIS**
- Esse segundo servidor Ã© quem realmente possui os dados

ğŸ“Œ ReferÃªncia:

- Lista de servidores WHOIS pode ser consultada no site da **IANA**

---

## 2ï¸âƒ£ Segunda RequisiÃ§Ã£o (Servidor Autoritativo)

- Enviamos a query para o servidor retornado anteriormente
- Esse servidor:
  - Possui as **informaÃ§Ãµes completas do domÃ­nio**
  - Retorna os dados desejados

---

# ğŸ› ï¸ Consulta WHOIS Manual

## ğŸ”Œ Porta Utilizada

- Toda comunicaÃ§Ã£o WHOIS ocorre via:
  - **TCP**
  - **Porta 43**

---

## ğŸ§ª Passo a Passo com `nc`

### ğŸ”¹ Conectar ao servidor WHOIS primÃ¡rio

```bash
nc -v whois.verisign-grs.com 43
```

ğŸ“Œ ObservaÃ§Ã£o:

- O servidor primÃ¡rio pode mudar
- Podemos consultar outro servidor inicial via:

```bash
nc -v whois.iana.org 43
```

---

### ğŸ”¹ Enviar o domÃ­nio

ApÃ³s a conexÃ£o, digitamos o domÃ­nio desejado:

```
globo.com
```

---

### ğŸ”¹ Identificar o servidor WHOIS correto

- A resposta retorna outro servidor, por exemplo:

```
whois.1api.net
```

---

### ğŸ”¹ Conectar ao servidor secundÃ¡rio

```bash
nc -v whois.1api.net 43
```

- Digitamos novamente o domÃ­nio
- Recebemos as **informaÃ§Ãµes completas**

---

# ğŸ Criando um Script WHOIS (`whois.py`)

## ğŸ“¦ MÃ³dulo Utilizado

- Usamos o mÃ³dulo **socket**

```python
import socket
```

---

## ğŸ”— Criando um Cliente TCP

```python
servidor = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
```

ğŸ“Œ ParÃ¢metros:

- `AF_INET` â†’ IPv4
- `SOCK_STREAM` â†’ TCP

---

## ğŸŒ Conectando ao Servidor WHOIS

- Sempre iniciamos pelo servidor da **IANA**
- Porta fixa: **43**

```python
servidor.connect(('whois.iana.org', 43))
```

---

## ğŸ“¤ Enviando o DomÃ­nio

```python
servidor.send(dominio_env.encode())
```

---

## ğŸ“¥ Recebendo a Resposta Inicial

```python
s_whois_primario = servidor.recv(1024).decode()
```

ğŸ“Œ ObservaÃ§Ã£o:

- A resposta Ã© longa
- ContÃ©m vÃ¡rias informaÃ§Ãµes
- Precisamos **filtrar** apenas o endereÃ§o do prÃ³ximo servidor

```python
.split()
```

---

## ğŸ” Repetindo o Processo

- Com o novo servidor WHOIS:
  - Criamos nova conexÃ£o
  - Enviamos o domÃ­nio novamente
- Receberemos outro servidor
  - Repetimos o processo mais uma vez
- Agora recebemos a **resposta final**

---

# âš ï¸ Problema do Buffer

## ğŸ“› LimitaÃ§Ã£o do `recv()`

```python
servidor.recv(1024).decode()
```

- O valor `1024` define o tamanho do buffer
- A resposta WHOIS final Ã© **muito grande**
- Mesmo aumentando o buffer, a resposta pode vir incompleta

---

# ğŸ”„ SoluÃ§Ã£o: Loop Infinito

## ğŸ” Leitura ContÃ­nua do Buffer

Criamos um loop que:

- Continua recebendo dados
- Para apenas quando nÃ£o houver mais resposta

---

## ğŸ“Œ Estrutura do Loop

```python
resposta_final = ""

while True:
    dados = servidor.recv(8024)
    if dados:
        resposta_final += dados.decode()
    else:
        break
```

ğŸ“Œ Funcionamento:

- Enquanto houver dados â†’ continua lendo
- Quando nÃ£o houver mais â†’ encerra o loop

---

## âœ… Resultado Final

- Script WHOIS funcional
- Realiza:
  - Consulta ao servidor referenciador
  - Descoberta do servidor autoritativo
  - Leitura completa da resposta

- Ideal para **Reconhecimento (Recon)** em seguranÃ§a da informaÃ§Ã£o
