import socket
import sys

def Servidor(servidor_whois, dominio_env):
    servidor = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    servidor.connect((servidor_whois, 43))
    servidor.send(dominio_env.encode())
    
    return servidor

dominio = sys.argv[1]
dominio_env = dominio+'\r\n'

servidor = Servidor("whois.iana.org", dominio_env)

s_whois_primario = servidor.recv(1024).decode().split("refer:        ")[1].split("\n")[0]
print(s_whois_primario)
servidor.close()

servidor = Servidor(s_whois_primario, dominio_env)

s_whois_secundario = servidor.recv(1024).decode().split("\n")[2].split(" ")[6]
s_whois_secundario = s_whois_secundario.replace("\r","")
print(s_whois_secundario)
servidor.close()

servidor = Servidor(s_whois_secundario, dominio_env)

reposta_final = ""
while True:
    dados = servidor.recv(8024)
    if dados:
        reposta_final+= dados.decode()
    else:
        break

with open(f"{dominio}-whois.txt", "w") as f:
    f.write(reposta_final)
    f.close()


