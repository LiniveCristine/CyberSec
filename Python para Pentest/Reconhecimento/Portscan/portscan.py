import socket
import sys

def checkport(IP, porta, service):
    cliente = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    cliente.settimeout(0.2)

    codigo = cliente.connect_ex((IP, porta))
    if codigo  == 0:
        print (f"{service:<15}{porta}/tcp\taberta")
        
    cliente.close()    

def dns(dominio):
    IP = socket.getaddrinfo(dominio, None, socket.AF_INET )
    return str(IP[0][4][0])

def criarDicionario(arquivo_portas):
    portas_dicionario = {}
    with open(arquivo_portas) as file:
        for i in file.readlines():
            linha = i.replace("\n", "").split(":")

            porta = int(linha[0])
            service = linha[1]
            portas_dicionario[porta] = service

        return portas_dicionario


dominio = sys.argv[1]
arquivo_portas = sys.argv[2]

IP = dns(dominio)
portas_dicionario = criarDicionario(arquivo_portas)

try:
    print("SERVIÃ‡O         PORTA")
    for porta in portas_dicionario:
        checkport(IP, porta, portas_dicionario[porta])

except KeyboardInterrupt:
    exit

