import socket
class Server:
    def TCP(IP, porta):
        senha_servidor = '123456'
        servidor = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
  
        servidor.bind((IP, porta))
        servidor.listen(1)

        print(f"Aguardando conexão {IP} {porta}")

        conexao, EndCliente = servidor.accept()
        print(f"\nConectado com: {EndCliente}\n")

        conexao.send("Digite a senha: ".encode())
        senha_usuario = conexao.recv(1024)

        if senha_usuario.decode() == senha_servidor:

            print(f"\n*** Senha correta ***")
            print("Conexão liberada\n")

            conexao.send("\n> *** Senha correta ***\n> Conexão liberada\n".encode())
            
            while True:
                mensagem = input("> ")

                if mensagem == 'sair':
                    conexao.send("< Conexão finalizada".encode())
                    servidor.close()
                    break
            
                mensagem = '\n< ' + mensagem 
                conexao.send(mensagem.encode())

                dados_cliente = conexao.recv(1024)

                if dados_cliente.decode() == '\nConexão encerrada\n': 

                    print("\nConexão encerrada\n")
                    servidor.close()
                    break
                print(f"< {dados_cliente.decode()}")

        else:
            conexao.send("\n> Senha incorreta".encode())
            servidor.close()

    def UDP(IP, porta):
        servidor = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

        servidor.bind((IP,porta))

        print(f"\nAguandando conexão UDP com {IP}:{porta}\n")

        while True:
            mensagemCliente, EndCliente = servidor.recvfrom(1024)

            if mensagemCliente.decode() == 'sair':
                print(f"< {'Finalizando...'} - {EndCliente}\n")
                servidor.close()
                break

            print(f"\n< {mensagemCliente.decode()} - {EndCliente}")

            mensagem = input("> ")

            if mensagem == 'sair':
                servidor.sendto('Finalizando...'.encode(), (EndCliente))
                servidor.close()
                break
            servidor.sendto(mensagem.encode(), (EndCliente))